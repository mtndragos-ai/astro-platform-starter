---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Dashboard Statistici | Management">
    <div class="admin-container">
        <!-- HEADER ADMIN -->
        <header class="admin-header">
            <div class="header-inner">
                <div class="brand-info">
                    <div class="title-with-status">
                        <h1>üìä Control Management</h1>
                        <div class="live-pulse">
                            <span class="pulse-dot"></span>
                            LIVE
                        </div>
                    </div>
                    <p>Monitorizare activitate tehnicieni √Æn timp real</p>
                </div>
                <div class="header-actions">
                    <a href="/categorii" class="back-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
                        √énapoi la Site
                    </a>
                </div>
            </div>
        </header>

        <main class="stats-content">
            <!-- CARDURI STATISTICE PRINCIPALE -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon users">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">UTILIZATORI ACTIVI AZI</span>
                        <span class="stat-value" id="total-users">0</span>
                        <div class="stat-indicator pos">Tehnicieni pe teren</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon downloads">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">TOTAL DESCƒÇRCƒÇRI AZI</span>
                        <span class="stat-value" id="total-downloads">0</span>
                        <div class="stat-indicator">Documente PDF accesate</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon time">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    </div>
                    <div class="stat-info">
                        <span class="stat-label">TIMP MEDIU UTILIZARE</span>
                        <span class="stat-value">18 min</span>
                        <div class="stat-indicator neg">Per sesiune tehnician</div>
                    </div>
                </div>
            </div>

            <!-- FEED ACTIVITATE - COLOANE ALINIATE -->
            <section class="activity-section">
                <div class="section-header">
                    <h2>Flux Activitate DetaliatƒÉ</h2>
                    <span class="date-badge" id="current-date">--/--/----</span>
                </div>

                <div class="table-container-custom">
                    <!-- Cap de tabel fixat in CSS grid -->
                    <div class="table-header-row">
                        <span>TEHNICIAN</span>
                        <span>AC»öIUNE</span>
                        <span>RESURSƒÇ / DETALII</span>
                        <span class="text-right">ORA ACCESƒÇRII</span>
                    </div>
                    
                    <div id="live-feed" class="list-wrapper">
                        <!-- Datele sunt injectate aici -->
                    </div>
                </div>
            </section>
        </main>
    </div>
</Layout>

<script is:inline>
    window.addEventListener('load', () => {
        // SeteazƒÉ data curentƒÉ
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('ro-RO');

        // Date simulate pentru aspectul vizual
        const mockData = [
            { user: "dragos.munteanu", action: "LOGIN", res: "Portal Training", time: "12:40", type: "portal" },
            { user: "cristian.boboi", action: "DOWNLOAD", res: "Optima TF Profi - Manual Service", time: "12:15", type: "pdf" },
            { user: "gabriel.chisiu", action: "VIDEO", res: "Tutorial Calibrare Optima", time: "11:58", type: "video" },
            { user: "alexandru.racila", action: "VIZUALIZARE", res: "Semanatori: Manual Service", time: "11:30", type: "folder" },
            { user: "florin.marin", action: "DOWNLOAD", res: "iXtrack T3 - Scheme Hidraulice", time: "10:45", type: "pdf" },
            { user: "vladimir.panaite", action: "LOGIN", res: "Portal Training", time: "09:12", type: "portal" }
        ];

        document.getElementById('total-users').innerText = new Set(mockData.map(d => d.user)).size;
        document.getElementById('total-downloads').innerText = mockData.filter(d => d.action === 'DOWNLOAD').length;

        const feed = document.getElementById('live-feed');
        
        mockData.forEach(row => {
            const icon = row.type === 'pdf' ? 'üìÑ' : row.type === 'video' ? 'üé¨' : row.type === 'folder' ? 'üìÇ' : 'üñ•Ô∏è';
            
            feed.innerHTML += `
                <div class="table-data-row">
                    <div class="user-info">
                        <div class="mini-avatar">${row.user.charAt(0).toUpperCase()}</div>
                        <div class="user-text">
                            <strong>${row.user}</strong>
                        </div>
                    </div>
                    <div class="action-cell">
                        <span class="badge-status ${row.action.toLowerCase()}">
                            <span class="dot"></span>
                            ${row.action}
                        </span>
                    </div>
                    <div class="res-info">
                        <span class="res-icon">${icon}</span>
                        ${row.res}
                    </div>
                    <div class="time-info">${row.time}</div>
                </div>
            `;
        });
    });
</script>

<style>
    .admin-container { background: #f4f7fa; min-height: 100vh; font-family: 'Roboto', sans-serif; color: #1f2937; }
    
    /* HEADER STYLES */
    .admin-header { background: #003087; color: white; padding: 2.5rem 0; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
    .header-inner { max-width: 1250px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
    
    .title-with-status { display: flex; align-items: center; gap: 15px; margin-bottom: 5px; }
    .title-with-status h1 { font-size: 1.75rem; font-weight: 900; letter-spacing: -0.5px; }
    
    .live-pulse { background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 900; display: flex; align-items: center; gap: 6px; border: 1px solid rgba(239, 68, 68, 0.3); }
    .pulse-dot { width: 8px; height: 8px; background: #ef4444; border-radius: 50%; box-shadow: 0 0 0 rgba(239, 68, 68, 0.4); animation: pulse 1.5s infinite; }
    
    @keyframes pulse { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

    .brand-info p { opacity: 0.8; font-size: 0.95rem; font-weight: 400; }
    
    .back-btn { background: rgba(255,255,255,0.1); padding: 0.7rem 1.4rem; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.2); transition: all 0.2s ease; }
    .back-btn:hover { background: white; color: #003087; transform: translateY(-2px); }

    .stats-content { max-width: 1250px; margin: -3rem auto 4rem auto; padding: 0 2rem; }
    
    /* STAT CARDS */
    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
    .stat-card { background: white; padding: 1.5rem; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 20px; transition: transform 0.2s; border: 1px solid #edf2f7; }
    .stat-card:hover { transform: translateY(-5px); }
    
    .stat-icon { width: 56px; height: 56px; border-radius: 14px; display: flex; align-items: center; justify-content: center; }
    .stat-icon.users { background: #ebf5ff; color: #003087; }
    .stat-icon.downloads { background: #fef3c7; color: #d97706; }
    .stat-icon.time { background: #f3e8ff; color: #7e22ce; }

    .stat-label { color: #64748b; font-size: 0.7rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; display: block; }
    .stat-value { font-size: 2.5rem; font-weight: 900; color: #1e293b; line-height: 1.2; display: block; }
    .stat-indicator { font-size: 0.8rem; font-weight: 600; color: #94a3b8; }

    /* TABLE LAYOUT - GRID CORECTAT */
    .activity-section { margin-top: 3.5rem; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
    .section-header h2 { font-size: 1.4rem; font-weight: 900; color: #0f172a; }
    .date-badge { background: #fff; color: #003087; padding: 8px 18px; border-radius: 12px; font-size: 0.9rem; font-weight: 800; border: 1px solid #e2e8f0; box-shadow: 0 2px 5px rgba(0,0,0,0.03); }

    .table-container-custom { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 4px 30px rgba(0,0,0,0.05); border: 1px solid #edf2f7; }
    
    /* DEFINIREA COLOANELOR - CRITIC PENTRU ALINIERE */
    .table-header-row, .table-data-row { 
        display: grid; 
        grid-template-columns: 1.5fr 1fr 2.5fr 0.8fr; 
        align-items: center;
        padding: 1.2rem 2.5rem;
    }

    .table-header-row { background: #f8fafc; border-bottom: 2px solid #f1f5f9; color: #64748b; font-weight: 900; font-size: 0.75rem; letter-spacing: 0.1em; }
    
    .table-data-row { border-bottom: 1px solid #f1f5f9; transition: all 0.2s; position: relative; }
    .table-data-row:hover { background: #f1f5f9; }
    .table-data-row:last-child { border-bottom: none; }

    .user-info { display: flex; align-items: center; gap: 15px; }
    .mini-avatar { width: 36px; height: 36px; background: #003087; color: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 0.9rem; box-shadow: 0 4px 10px rgba(0,48,135,0.2); }
    .user-text strong { font-size: 0.95rem; color: #0f172a; }
    
    /* BADGE STYLES */
    .badge-status { padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; font-weight: 900; display: inline-flex; align-items: center; gap: 6px; letter-spacing: 0.5px; }
    .badge-status .dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; }
    
    .login { background: #dcfce7; color: #166534; }
    .download { background: #dbeafe; color: #1e40af; }
    .video { background: #fef3c7; color: #92400e; }
    .vizualizare { background: #f1f5f9; color: #475569; }

    .res-info { font-size: 0.95rem; color: #334155; font-weight: 500; display: flex; align-items: center; gap: 10px; }
    .res-icon { font-size: 1.2rem; }
    
    .time-info { text-align: right; color: #64748b; font-weight: 800; font-size: 0.9rem; }
    .text-right { text-align: right; }

    @media (max-width: 1024px) {
        .stats-grid { grid-template-columns: 1fr; }
        .table-header-row { display: none; }
        .table-data-row { grid-template-columns: 1fr; gap: 10px; padding: 1.5rem; }
        .time-info { text-align: left; background: #f8fafc; padding: 5px 10px; border-radius: 6px; display: inline-block; width: fit-content; }
        .text-right { text-align: left; }
    }
</style>